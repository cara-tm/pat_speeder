<h1>Speed up your <span class="caps">TXP</span> websites! üöÄ</h1>

<p>Have you ever seen the source code of the Google homepage? For speed reasons, Google serves its homepage as a single line of code. The benefit is a reduction in file size and bandwidth usage. Now we can do the same for our <span class="caps">TXP</span> websites.</p>

<p>Just activate this plugin and your page templates will be rendered as a single line of code.</p>

<p><strong>Warning</strong>: This plugin seems not to be compatible with some flash audio players (to be confirmed).</p>

<p>Furthermore, for a long time I thought to preserve paddings before and after each link (&#8220;a&#8221; tags) and I added a space between all <span class="caps">HTML</span> code within the compressed copy in order to keep visual appearances unchanged. But all these extra spaces are not parts of natural and well written text contents. It encourages you to add them before and after! Keep that in mind, write good content and gain 1.03% in compression (spaces between <code>&lt;a&gt;</code> tags will be removed).</p>

<p>An additional preference is available for more compact compression with all spaces removed (Default: false).</p>

<h2>Test results</h2>

<p>According to Ruud&#8217;s observations, this plugin results in a reduction of between 5% (for precompressed pages) and 6% (normal pages).</p>

<h2>Usage</h2>

<p>Add the following tag at the very top of your page templates:</p>

<p><code>&lt;txp:pat_speeder /&gt;</code></p>

<h2>Attributes</h2>

<p>This plugin has the following attributes:</p>

<ul>
	<li><code>enable</code> boolean: set &#8220;boolean&#8221; to 1 activate the plugin. Set to 0 disabled it. Default 1 (yes).</li>
	<li><code>gzip</code> boolean (optional): server side gzip compression. Default: 1 (true).</li>
	<li><code>code</code> (optional): a comma separated list of tags name on which do not apply compression. Default: <code>script,svg,pre,code</code></li>
	<li><code>compact</code> (optional): further reduction by removing all duplicate spaces. See note below.</li>
</ul>


<h2>Example</h2>

<p><code>&lt;txp:pat_speeder enable=&quot;0&quot; /&gt;&lt;!DOCTYPE ...</code></p>

<p>In this case, pat_speeder is&#8217;nt enable into this current page template.</p>


<h2>Preferences</h2>

<p>After installation, go to your website preferences:</p>

<ul>
	<li><em>Enable pat_speeder?</em> Allow you to stop this plugin rendering thougout all your pages where it is used (only if the <code>enable</code> attibute is set on <code>1</code>);</li>
	<li><em>Enable <span class="caps">GZIP</span> compression with pat_speeder?</em> Choose to activate the internal <code>GZIP</code> compression if needed (you may set your <code>.htaccess</code> file instead) only if the gzip attribute isn&#8217;t set into this plugin tag;</li>
	<li><em>List of tags to protect from pat_speeder</em> A comma separated list of tags to protect against the plugin throughout all the site. Default: <code>script, svg, pre, code</code>. Note: <code>textarea</code> is included into the plugin;</li>
	<li><em>Enable extreme compression?</em> This is a ‚Äúcompact mode‚Äù that removes all unnecessary spaces (to be precise: <strong>2 or more</strong>) between all tags to return a smaller document in size. Bear in mind that your page and form markup must be cleanly written without additional spaces around tags. This can otherwise result in unexpected results such as text content directly adjacent to one another (e.g. a link running straight into text). As such, this settings is recommended only for advanced users.</li>
</ul>


<h2>Changelog</h2>

<ul>
	<li>v0.1 on Jul, 22sd 2009. First release</li>
	<li>v0.2 on Jul, 26th 2009. Second release. Adding some code submitted by Rudd.</li>
	<li>v0.3 on Jul, 28th 2009. Third release. Mask html comments and css comments but preserve IE conditional comments.</li>
	<li>v0.3.a on Jul 2009. Intermediate pre final release. The array() had been changed by a stronger regex.</li>
	<li>v0.3.b on Jul, 30 2009. Final release. Support for <code>pre</code> tags.</li>
	<li>v0.4 on Jul, 29th 2009. <em>Non intrusive release</em>:  Add &#8220;enable&#8221; attribute.</li>
	<li>v0.4a &amp; v0.4b. Unpublished. For testing purposes only.</li>
	<li>v0.4c on Jul, 06 2011. Add support in regex for &#8220;HTML5/Boilerplate&#8221; doctype declaration method.</li>
	<li>v0.4.d on August, 18th 2013. Minor changes for better support of pre &amp; code statements.</li>
	<li>v0.5 on March, 25th 2014. Corrects removing space between some tags.</li>
	<li>v0.6 on March, 27th 2014. Corrects errors. Remove <span class="caps">HTML</span> comments.</li>
	<li>v0.7 on May, 26th 2015. Add server side compression. Add &#8220;gzip&#8221; attribute. Better new line removing server system independant.</li>
	<li>v0.7.1 on May, 30th 2015. Remove extra spaces between all tags.</li>
	<li>v0.7.5 on June, 22th 2018. Improvement; keep google bot comments.</li>
	<li>v1.0 on July, 14th 2018. better support for IE conditional comments into the <code>head</code> part of the document; support for the Google comments (i.e. <code>&lt;!--googleoff: all--&gt;</code>); better support for accentuated languages.</li>
	<li>v1.1 on July, 23th 2018. Final version.</li>
	<li>v1.1.1 on August, 25th 2018. Add option to only compress when the site production status is ‚Äòlive‚Äô.</li>
	<li>v1.1.2 on November, 18th 2019. Correct tag registration.</li>
	<li>v2.0 on March, 1st 2024. Global revision of the code.</li>
</ul>

<p>See also the <a href="https://forum.textpattern.com/viewtopic.php?id=31345">forum thread</a> for requests or help.</p>


<h2>Additional Optimization</h2>

<p><strong>Not needed for version 0.7: information retained for posterity</strong>.</p>

<p>If you want to further reduce the size of your website and assets, you can take advantage on your server&#8217;s gzip compression for all your other files (css, javascript, php, images) regardless of where they are located. This can produce significant gains of up to 80%. In your <code>.htaccess</code> file,  add the following lines of code:</p>

<pre><code>&lt;IfModule mod_gzip.c&gt;
    mod_gzip_on       Yes
    mod_gzip_dechunk  Yes
    mod_gzip_item_include file      \.(html?|txt|css|js|php|pl)$
    mod_gzip_item_include handler   ^cgi-script$
    mod_gzip_item_include mime      ^text/.*
    mod_gzip_item_include mime      ^application/x-javascript.*
    mod_gzip_item_exclude mime      ^image/.*
    mod_gzip_item_exclude rspheader ^Content-Encoding:.*gzip.*
&lt;/IfModule&gt;</code></pre>

<h2>Acknowledgments</h2>

<p>Special thanks to <a href="http://vanmelick.com/txp/">Ruud</a> for his good advice and to Jakob for some code reviews (previous version).</p>